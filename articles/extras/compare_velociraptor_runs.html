<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>velociraptor sanity check • velociraptor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="velociraptor sanity check">
<meta property="og:description" content="velociraptor">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">velociraptor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/velociraptor.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/extras/compare_velociraptor_runs.html">velociraptor sanity check</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/index.html">More...</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kevinrue/velociraptor/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="compare_velociraptor_runs_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>velociraptor sanity check</h1>
            
            <h4 class="date">2021-02-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kevinrue/velociraptor/blob/master/vignettes/extras/compare_velociraptor_runs.Rmd"><code>vignettes/extras/compare_velociraptor_runs.Rmd</code></a></small>
      <div class="hidden name"><code>compare_velociraptor_runs.Rmd</code></div>

    </div>

    
    
<div id="load-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>Load packages</h1>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scRNAseq</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scuttle</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scran</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kevinrue/velociraptor">velociraptor</a></span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/">scater</a></span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally/">GGally</a></span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/reticulate">reticulate</a></span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SingleCellExperiment</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">basilisk</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
</div>
<div id="define-virtual-environment-to-use-for-reticulate" class="section level1">
<h1 class="hasAnchor">
<a href="#define-virtual-environment-to-use-for-reticulate" class="anchor"></a>Define virtual environment to use for reticulate</h1>
<p>We use the <code>velociraptor</code> conda environment in order to run the scVelo commands also directly in python.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/use_python.html">use_virtualenv</a></span><span class="op">(</span><span class="fu">basilisk</span><span class="fu">:::</span><span class="fu">.obtainEnvironmentPath</span><span class="op">(</span><span class="fu">velociraptor</span><span class="fu">:::</span><span class="va">velo.env</span><span class="op">)</span><span class="op">)</span>
<span class="va">sys</span> <span class="op">&lt;-</span> <span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/import.html">import</a></span><span class="op">(</span><span class="st">"sys"</span><span class="op">)</span>
<span class="va">sys</span><span class="op">$</span><span class="va">version</span></code></pre></div>
<pre><code>## [1] "3.7.7 (default, May  7 2020, 21:31:28) \n[GCC 7.3.0]"</code></pre>
</div>
<div id="set-temporary-directory" class="section level1">
<h1 class="hasAnchor">
<a href="#set-temporary-directory" class="anchor"></a>Set temporary directory</h1>
<p>Output objects (to move data from SCE to AnnData without using basilisk) are saved to a temporary directory.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmpdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="prepare-data" class="section level1">
<h1 class="hasAnchor">
<a href="#prepare-data" class="anchor"></a>Prepare data</h1>
<p>We use an example data set from <code>scRNAseq</code>, and subset to the first 500 cells. Next, we preprocess the data set by selecting highly variable genes and applying PCA and tSNE. The object is also saved to a h5ad file for use with scVelo directly in python.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load and subset data</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">scRNAseq</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scRNAseq/man/HermannSpermatogenesisData.html">HermannSpermatogenesisData</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">500</span><span class="op">]</span></code></pre></div>
<pre><code>## using temporary cache /tmp/RtmpClkDvF/BiocFileCache</code></pre>
<pre><code>## snapshotDate(): 2021-02-19</code></pre>
<pre><code>## see ?scRNAseq and browseVignettes('scRNAseq') for documentation</code></pre>
<pre><code>## downloading 1 resources</code></pre>
<pre><code>## retrieving 1 resource</code></pre>
<pre><code>## loading from cache</code></pre>
<pre><code>## see ?scRNAseq and browseVignettes('scRNAseq') for documentation</code></pre>
<pre><code>## downloading 1 resources</code></pre>
<pre><code>## retrieving 1 resource</code></pre>
<pre><code>## loading from cache</code></pre>
<pre><code>## see ?scRNAseq and browseVignettes('scRNAseq') for documentation</code></pre>
<pre><code>## downloading 1 resources</code></pre>
<pre><code>## retrieving 1 resource</code></pre>
<pre><code>## loading from cache</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Add 'counts' assay</span>
<span class="fu">assay</span><span class="op">(</span><span class="va">sce</span>, <span class="st">"counts"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">assay</span><span class="op">(</span><span class="va">sce</span>, <span class="st">"spliced"</span><span class="op">)</span>

<span class="co">## Save to h5ad file for python scVelo analysis</span>
<span class="fu">zellkonverter</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zellkonverter/man/writeH5AD.html">writeH5AD</a></span><span class="op">(</span><span class="va">sce</span>, X_name <span class="op">=</span> <span class="st">"counts"</span>, 
                         file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tmpdir</span>, <span class="st">"anndata.h5ad"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="run-analysis-directly-in-python" class="section level1">
<h1 class="hasAnchor">
<a href="#run-analysis-directly-in-python" class="anchor"></a>Run analysis directly in python</h1>
<p>We use the same conda environment as in <code>velociraptor</code> to run the scVelo analysis directly in python, rather than via the R wrapper.</p>
<div id="steady-state-model" class="section level2">
<h2 class="hasAnchor">
<a href="#steady-state-model" class="anchor"></a>Steady-state model</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scanpy <span class="im">as</span> sc</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> anndata</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scvelo <span class="im">as</span> scv</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> os <span class="im">import</span> path</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>adata<span class="op">=</span>anndata.read(r.tmpdir <span class="op">+</span> <span class="st">"/anndata.h5ad"</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>scv.pp.filter_and_normalize(adata, enforce<span class="op">=</span><span class="va">True</span>, n_top_genes<span class="op">=</span><span class="dv">2000</span>)</span></code></pre></div>
<pre><code>## Normalized count data: X, spliced, unspliced.
## Exctracted 2000 highly variable genes.
## Logarithmized X.</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>scv.pp.moments(adata)</span></code></pre></div>
<pre><code>## computing neighbors
##     finished (0:00:04) --&gt; added 
##     'distances' and 'connectivities', weighted adjacency matrices (adata.obsp)
## computing moments based on connectivities
##     finished (0:00:00) --&gt; added 
##     'Ms' and 'Mu', moments of un/spliced abundances (adata.layers)</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>scv.tl.velocity(adata, mode<span class="op">=</span><span class="st">"steady_state"</span>)</span></code></pre></div>
<pre><code>## computing velocities
##     finished (0:00:00) --&gt; added 
##     'velocity', velocity vectors for each individual cell (adata.layers)</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>scv.tl.velocity_graph(adata)</span></code></pre></div>
<pre><code>## computing velocity graph
## 
... 100%
    finished (0:00:00) --&gt; added 
##     'velocity_graph', sparse matrix with cosine correlations (adata.uns)</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>scv.tl.velocity_pseudotime(adata)</span></code></pre></div>
<pre><code>## computing terminal states
## WARNING: Uncertain or fuzzy root cell identification. Please verify.
##     identified 1 region of root cells and 1 region of end points .
##     finished (0:00:00) --&gt; added
##     'root_cells', root cells of Markov diffusion process (adata.obs)
##     'end_points', end points of Markov diffusion process (adata.obs)</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>scv.tl.velocity_confidence(adata)</span></code></pre></div>
<pre><code>## --&gt; added 'velocity_length' (adata.obs)
## --&gt; added 'velocity_confidence' (adata.obs)
## --&gt; added 'velocity_confidence_transition' (adata.obs)</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>adata.write(r.tmpdir <span class="op">+</span> <span class="st">"/anndata_withvelo_steadystate.h5ad"</span>)</span></code></pre></div>
</div>
<div id="dynamical-model" class="section level2">
<h2 class="hasAnchor">
<a href="#dynamical-model" class="anchor"></a>Dynamical model</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scanpy <span class="im">as</span> sc</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> anndata</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scvelo <span class="im">as</span> scv</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>adata<span class="op">=</span>anndata.read(r.tmpdir <span class="op">+</span> <span class="st">"/anndata.h5ad"</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>scv.pp.filter_and_normalize(adata, enforce<span class="op">=</span><span class="va">True</span>, n_top_genes<span class="op">=</span><span class="dv">2000</span>)</span></code></pre></div>
<pre><code>## Normalized count data: X, spliced, unspliced.
## Exctracted 2000 highly variable genes.
## Logarithmized X.</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>scv.pp.moments(adata)</span></code></pre></div>
<pre><code>## computing neighbors
##     finished (0:00:00) --&gt; added 
##     'distances' and 'connectivities', weighted adjacency matrices (adata.obsp)
## computing moments based on connectivities
##     finished (0:00:00) --&gt; added 
##     'Ms' and 'Mu', moments of un/spliced abundances (adata.layers)</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>scv.tl.recover_dynamics(adata)</span></code></pre></div>
<pre><code>## recovering dynamics
## 
... 2%
... 4%
... 6%
... 8%
... 10%
... 12%
... 15%
... 17%
... 20%
... 22%
... 24%
... 26%
... 29%
... 31%
... 33%
... 36%
... 38%
... 40%
... 42%
... 44%
... 47%
... 49%
... 52%
... 54%
... 56%
... 58%
... 61%
... 62%
... 65%
... 67%
... 70%
... 72%
... 75%
... 77%
... 79%
... 81%
... 84%
... 86%
... 88%
... 91%
... 93%
... 96%
... 98%
... 100%
    finished (0:02:15) --&gt; added 
##     'fit_pars', fitted parameters for splicing dynamics (adata.var)</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>scv.tl.velocity(adata, mode<span class="op">=</span><span class="st">"dynamical"</span>)</span></code></pre></div>
<pre><code>## computing velocities
##     finished (0:00:00) --&gt; added 
##     'velocity', velocity vectors for each individual cell (adata.layers)</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>scv.tl.velocity_graph(adata)</span></code></pre></div>
<pre><code>## computing velocity graph
## 
... 100%
    finished (0:00:00) --&gt; added 
##     'velocity_graph', sparse matrix with cosine correlations (adata.uns)</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>scv.tl.velocity_pseudotime(adata)</span></code></pre></div>
<pre><code>## computing terminal states
##     identified 1 region of root cells and 1 region of end points .
##     finished (0:00:00) --&gt; added
##     'root_cells', root cells of Markov diffusion process (adata.obs)
##     'end_points', end points of Markov diffusion process (adata.obs)</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>scv.tl.latent_time(adata)</span></code></pre></div>
<pre><code>## computing latent time using root_cells as prior
##     finished (0:00:00) --&gt; added 
##     'latent_time', shared time (adata.obs)</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>scv.tl.velocity_confidence(adata)</span></code></pre></div>
<pre><code>## --&gt; added 'velocity_length' (adata.obs)
## --&gt; added 'velocity_confidence' (adata.obs)
## --&gt; added 'velocity_confidence_transition' (adata.obs)</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>adata.write(r.tmpdir <span class="op">+</span> <span class="st">"/anndata_withvelo_dynamical.h5ad"</span>)</span></code></pre></div>
</div>
<div id="read-back-objects-in-r-for-later-comparison" class="section level2">
<h2 class="hasAnchor">
<a href="#read-back-objects-in-r-for-later-comparison" class="anchor"></a>Read back objects in R for later comparison</h2>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sceps</span> <span class="op">&lt;-</span> <span class="fu">zellkonverter</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zellkonverter/man/readH5AD.html">readH5AD</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tmpdir</span>, <span class="st">"anndata_withvelo_steadystate.h5ad"</span><span class="op">)</span><span class="op">)</span>
<span class="va">scepd</span> <span class="op">&lt;-</span> <span class="fu">zellkonverter</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zellkonverter/man/readH5AD.html">readH5AD</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">tmpdir</span>, <span class="st">"anndata_withvelo_dynamical.h5ad"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="process-the-data-set" class="section level1">
<h1 class="hasAnchor">
<a href="#process-the-data-set" class="anchor"></a>Process the data set</h1>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">scuttle</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html">logNormCounts</a></span><span class="op">(</span><span class="va">sce</span>, assay.type<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="co">## To use the HVGs determined by scVelo</span>
<span class="co"># top.hvgs &lt;- rownames(sceps)</span>

<span class="co">## To get HVGs with scran</span>
<span class="va">dec</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/modelGeneVar.html">modelGeneVar</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in regularize.values(x, y, ties, missing(ties), na.rm = na.rm):
## collapsing to unique 'x' values</code></pre>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top.hvgs</span> <span class="op">&lt;-</span> <span class="fu">scran</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scran/man/getTopHVGs.html">getTopHVGs</a></span><span class="op">(</span><span class="va">dec</span>, n<span class="op">=</span><span class="fl">2000</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/runPCA.html">runPCA</a></span><span class="op">(</span><span class="va">sce</span>, subset_row<span class="op">=</span><span class="va">top.hvgs</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu">scater</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/scater/man/runTSNE.html">runTSNE</a></span><span class="op">(</span><span class="va">sce</span>, dimred<span class="op">=</span><span class="st">"PCA"</span><span class="op">)</span></code></pre></div>
</div>
<div id="helper-function" class="section level1">
<h1 class="hasAnchor">
<a href="#helper-function" class="anchor"></a>Helper function</h1>
<p>The function below runs scVelo via the R wrapper, first using the pre-normalized data and PCA from the SingleCellExperiment object, and then with <code>use_theirs=TRUE</code>. It also performs some comparisons between the two results.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">run_scv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sce</span>, <span class="va">top.hvgs</span>, <span class="va">mode</span><span class="op">)</span> <span class="op">{</span>
    <span class="co">## precomputed PCs and normalized values</span>
    <span class="va">velo.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/scvelo.html">scvelo</a></span><span class="op">(</span>
        <span class="va">sce</span>, assay.X<span class="op">=</span><span class="st">"counts"</span>, sf.X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/sizeFactors.html">sizeFactors</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>, 
        subset.row<span class="op">=</span><span class="va">top.hvgs</span>, use.dimred<span class="op">=</span><span class="st">"PCA"</span>,
        mode<span class="op">=</span><span class="va">mode</span>
    <span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">velo.out</span><span class="op">)</span><span class="op">)</span>
    <span class="va">sce</span><span class="op">$</span><span class="va">velocity_pseudotime</span> <span class="op">&lt;-</span> <span class="va">velo.out</span><span class="op">$</span><span class="va">velocity_pseudotime</span>
    
    <span class="co">## using scVelo normalization, gene selection and PCA calculation</span>
    <span class="va">velo.out_theirs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/scvelo.html">scvelo</a></span><span class="op">(</span>
        <span class="va">sce</span>, assay.X<span class="op">=</span><span class="st">"counts"</span>, use.theirs<span class="op">=</span><span class="cn">TRUE</span>, mode<span class="op">=</span><span class="va">mode</span>,
        scvelo.params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>filter_and_normalize<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>enforce<span class="op">=</span><span class="cn">TRUE</span>, 
                                                     n_top_genes<span class="op">=</span><span class="fl">2000L</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">velo.out_theirs</span><span class="op">)</span><span class="op">)</span>
    <span class="va">sce</span><span class="op">$</span><span class="va">velocity_pseudotime_theirs</span> <span class="op">&lt;-</span> <span class="va">velo.out_theirs</span><span class="op">$</span><span class="va">velocity_pseudotime</span>

    <span class="co">## Inferred pseudotime</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>
        <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span>
            <span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotTSNE</a></span><span class="op">(</span><span class="va">sce</span>, colour_by<span class="op">=</span><span class="st">"velocity_pseudotime"</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotTSNE</a></span><span class="op">(</span><span class="va">sce</span>, colour_by<span class="op">=</span><span class="st">"velocity_pseudotime_theirs"</span><span class="op">)</span>,
            nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/scater/man/plot_reddim.html">plotTSNE</a></span><span class="op">(</span><span class="va">sce</span>, colour_by<span class="op">=</span><span class="st">"celltype"</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span>
    <span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">GGally</span><span class="fu">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"velocity_pseudotime"</span>, 
                                                          <span class="st">"velocity_pseudotime_theirs"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

    <span class="va">shared_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="va">intersect</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">velo.out</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">velo.out_theirs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Number of shared genes:"</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">shared_genes</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Ours:"</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>shared <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">velo.out</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">shared_genes</span>,
                velogene <span class="op">=</span> <span class="fu">rowData</span><span class="op">(</span><span class="va">velo.out</span><span class="op">)</span><span class="op">$</span><span class="va">velocity_genes</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Theirs:"</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>shared <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">velo.out_theirs</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">shared_genes</span>,
                velogene <span class="op">=</span> <span class="fu">rowData</span><span class="op">(</span><span class="va">velo.out_theirs</span><span class="op">)</span><span class="op">$</span><span class="va">velocity_genes</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Among shared genes, how many are velocity genes:"</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>ours <span class="op">=</span> <span class="fu">rowData</span><span class="op">(</span><span class="va">velo.out</span><span class="op">[</span><span class="va">shared_genes</span>, <span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">velocity_genes</span>,
                theirs <span class="op">=</span> <span class="fu">rowData</span><span class="op">(</span><span class="va">velo.out_theirs</span><span class="op">[</span><span class="va">shared_genes</span>, <span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">velocity_genes</span><span class="op">)</span><span class="op">)</span>
    
    <span class="co">## Correlations of velocities</span>
    <span class="va">velo_corrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">velo.out</span><span class="op">[</span><span class="va">shared_genes</span>, <span class="op">]</span>, <span class="st">"velocity"</span><span class="op">)</span>, 
                           <span class="fu">assay</span><span class="op">(</span><span class="va">velo.out_theirs</span><span class="op">[</span><span class="va">shared_genes</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">velo.out</span><span class="op">)</span><span class="op">]</span>,
                                 <span class="st">"velocity"</span><span class="op">)</span>,
                           use <span class="op">=</span> <span class="st">"pairwise.complete"</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">velo_corrs</span>, <span class="fl">100</span><span class="op">)</span>
    
    <span class="co">## Correlations of normalized spliced/unspliced values</span>
    <span class="va">ms_corrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">velo.out</span><span class="op">[</span><span class="va">shared_genes</span>, <span class="op">]</span>, <span class="st">"Ms"</span><span class="op">)</span>, 
                         <span class="fu">assay</span><span class="op">(</span><span class="va">velo.out_theirs</span><span class="op">[</span><span class="va">shared_genes</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">velo.out</span><span class="op">)</span><span class="op">]</span>,
                               <span class="st">"Ms"</span><span class="op">)</span>,
                         use <span class="op">=</span> <span class="st">"pairwise.complete"</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">ms_corrs</span>, <span class="fl">100</span><span class="op">)</span>
    <span class="va">mu_corrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">velo.out</span><span class="op">[</span><span class="va">shared_genes</span>, <span class="op">]</span>, <span class="st">"Mu"</span><span class="op">)</span>, 
                         <span class="fu">assay</span><span class="op">(</span><span class="va">velo.out_theirs</span><span class="op">[</span><span class="va">shared_genes</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">velo.out</span><span class="op">)</span><span class="op">]</span>,
                               <span class="st">"Mu"</span><span class="op">)</span>,
                         use <span class="op">=</span> <span class="st">"pairwise.complete"</span><span class="op">)</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">mu_corrs</span>, <span class="fl">100</span><span class="op">)</span>
    
    <span class="va">velo.out_theirs</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="run-scvelo" class="section level1">
<h1 class="hasAnchor">
<a href="#run-scvelo" class="anchor"></a>Run scVelo</h1>
<div id="dynamical-model-1" class="section level2">
<h2 class="hasAnchor">
<a href="#dynamical-model-1" class="anchor"></a>Dynamical model</h2>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sced</span> <span class="op">&lt;-</span> <span class="fu">run_scv</span><span class="op">(</span><span class="va">sce</span>, top.hvgs<span class="op">=</span><span class="va">top.hvgs</span>, mode<span class="op">=</span><span class="st">"dynamical"</span><span class="op">)</span></code></pre></div>
<p><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
<pre><code>## Number of shared genes:</code></pre>
<pre><code>## [1] 1036</code></pre>
<pre><code>## Ours:</code></pre>
<pre><code>##        velogene
## shared  FALSE TRUE
##   FALSE   637  327
##   TRUE    720  316</code></pre>
<pre><code>## Theirs:</code></pre>
<pre><code>##        velogene
## shared  FALSE TRUE
##   FALSE   589  375
##   TRUE    739  297</code></pre>
<pre><code>## Among shared genes, how many are velocity genes:</code></pre>
<p><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-10-2.png" width="768"></p>
<pre><code>##        theirs
## ours    FALSE TRUE
##   FALSE   712    8
##   TRUE     27  289</code></pre>
<p><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-10-3.png" width="768"><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-10-4.png" width="768"><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-10-5.png" width="768"></p>
<div id="compare-our-run-with-use_theirstrue-to-direct-python-calls" class="section level3">
<h3 class="hasAnchor">
<a href="#compare-our-run-with-use_theirstrue-to-direct-python-calls" class="anchor"></a>Compare our run with ‘use_theirs=TRUE’ to direct python calls</h3>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sced</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">scepd</span><span class="op">)</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sced</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">scepd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">## Correlations of velocities</span>
<span class="va">velo_corrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">sced</span>, <span class="st">"velocity"</span><span class="op">)</span>, 
                       <span class="fu">assay</span><span class="op">(</span><span class="va">scepd</span>, <span class="st">"velocity"</span><span class="op">)</span>,
                       use <span class="op">=</span> <span class="st">"pairwise.complete"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">velo_corrs</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##       1       1       1       1       1       1</code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sced</span><span class="op">$</span><span class="va">velocity_pseudotime</span>, <span class="va">scepd</span><span class="op">$</span><span class="va">velocity_pseudotime</span><span class="op">)</span></code></pre></div>
<p><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">sced</span><span class="op">$</span><span class="va">velocity_pseudotime</span> <span class="op">-</span> <span class="va">scepd</span><span class="op">$</span><span class="va">velocity_pseudotime</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 0.000e+00 1.788e-07 5.774e-07 6.633e-07 9.835e-07 2.444e-06</code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">sced</span><span class="op">$</span><span class="va">velocity_pseudotime</span> <span class="op">-</span> <span class="va">scepd</span><span class="op">$</span><span class="va">velocity_pseudotime</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-3</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="steady-state-model-1" class="section level2">
<h2 class="hasAnchor">
<a href="#steady-state-model-1" class="anchor"></a>Steady-state model</h2>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sces</span> <span class="op">&lt;-</span> <span class="fu">run_scv</span><span class="op">(</span><span class="va">sce</span>, top.hvgs<span class="op">=</span><span class="va">top.hvgs</span>, mode<span class="op">=</span><span class="st">"steady_state"</span><span class="op">)</span></code></pre></div>
<p><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-12-1.png" width="768"></p>
<pre><code>## Number of shared genes:</code></pre>
<pre><code>## [1] 1036</code></pre>
<pre><code>## Ours:</code></pre>
<pre><code>##        velogene
## shared  FALSE TRUE
##   FALSE   788  176
##   TRUE    741  295</code></pre>
<pre><code>## Theirs:</code></pre>
<pre><code>##        velogene
## shared  FALSE TRUE
##   FALSE   619  345
##   TRUE    750  286</code></pre>
<pre><code>## Among shared genes, how many are velocity genes:</code></pre>
<p><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-12-2.png" width="768"></p>
<pre><code>##        theirs
## ours    FALSE TRUE
##   FALSE   738    3
##   TRUE     12  283</code></pre>
<p><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-12-3.png" width="768"><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-12-4.png" width="768"><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-12-5.png" width="768"></p>
<div id="compare-our-run-with-use_theirstrue-to-direct-python-calls-1" class="section level3">
<h3 class="hasAnchor">
<a href="#compare-our-run-with-use_theirstrue-to-direct-python-calls-1" class="anchor"></a>Compare our run with ‘use_theirs=TRUE’ to direct python calls</h3>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sces</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sceps</span><span class="op">)</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sces</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">sceps</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">## Correlations of velocities</span>
<span class="va">velo_corrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="fu">assay</span><span class="op">(</span><span class="va">sces</span>, <span class="st">"velocity"</span><span class="op">)</span>, 
                       <span class="fu">assay</span><span class="op">(</span><span class="va">sceps</span>, <span class="st">"velocity"</span><span class="op">)</span>,
                       use <span class="op">=</span> <span class="st">"pairwise.complete"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">velo_corrs</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##       1       1       1       1       1       1</code></pre>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sces</span><span class="op">$</span><span class="va">velocity_pseudotime</span>, <span class="va">sceps</span><span class="op">$</span><span class="va">velocity_pseudotime</span><span class="op">)</span></code></pre></div>
<p><img src="compare_velociraptor_runs_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">sces</span><span class="op">$</span><span class="va">velocity_pseudotime</span> <span class="op">-</span> <span class="va">sceps</span><span class="op">$</span><span class="va">velocity_pseudotime</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 0.000e+00 7.153e-07 2.012e-06 2.216e-06 3.695e-06 4.947e-06</code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">sces</span><span class="op">$</span><span class="va">velocity_pseudotime</span> <span class="op">-</span> <span class="va">sceps</span><span class="op">$</span><span class="va">velocity_pseudotime</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-3</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R Under development (unstable) (2021-02-18 r80027)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.1 LTS
## 
## Matrix products: default
## BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] parallel stats    graphics utils    stats4   methods  base    
## 
## other attached packages:
##  [1] basilisk_1.3.6               reticulate_1.18             
##  [3] GGally_2.1.0                 cowplot_1.1.1               
##  [5] scater_1.19.10               ggplot2_3.3.3               
##  [7] velociraptor_1.1.5           scran_1.19.14               
##  [9] scuttle_1.1.16               scRNAseq_2.5.7              
## [11] SingleCellExperiment_1.13.12 SummarizedExperiment_1.21.1 
## [13] Biobase_2.51.0               GenomicRanges_1.43.3        
## [15] GenomeInfoDb_1.27.6          IRanges_2.25.6              
## [17] S4Vectors_0.29.7             BiocGenerics_0.37.1         
## [19] MatrixGenerics_1.3.1         matrixStats_0.58.0          
## 
## loaded via a namespace (and not attached):
##   [1] AnnotationHub_2.23.2          BiocFileCache_1.15.1         
##   [3] systemfonts_1.0.1             plyr_1.8.6                   
##   [5] igraph_1.2.6                  lazyeval_0.2.2               
##   [7] BiocParallel_1.25.4           digest_0.6.27                
##   [9] ensembldb_2.15.2              htmltools_0.5.1.1            
##  [11] viridis_0.5.1                 magrittr_2.0.1               
##  [13] memoise_2.0.0                 ScaledMatrix_0.99.2          
##  [15] limma_3.47.8                  Biostrings_2.59.2            
##  [17] askpass_1.1                   pkgdown_1.6.1                
##  [19] prettyunits_1.1.1             colorspace_2.0-0             
##  [21] blob_1.2.1                    rappdirs_0.3.3               
##  [23] textshaping_0.3.0             xfun_0.21                    
##  [25] dplyr_1.0.4                   crayon_1.4.1                 
##  [27] RCurl_1.98-1.2                jsonlite_1.7.2               
##  [29] glue_1.4.2                    gtable_0.3.0                 
##  [31] zlibbioc_1.37.0               XVector_0.31.1               
##  [33] DelayedArray_0.17.8           BiocSingular_1.7.2           
##  [35] scales_1.1.1                  DBI_1.1.1                    
##  [37] edgeR_3.33.2                  Rcpp_1.0.6                   
##  [39] viridisLite_0.3.0             xtable_1.8-4                 
##  [41] progress_1.2.2                dqrng_0.2.1                  
##  [43] bit_4.0.4                     rsvd_1.0.3                   
##  [45] metapod_0.99.5                httr_1.4.2                   
##  [47] RColorBrewer_1.1-2            ellipsis_0.3.1               
##  [49] farver_2.0.3                  reshape_0.8.8                
##  [51] pkgconfig_2.0.3               XML_3.99-0.5                 
##  [53] sass_0.3.1                    dbplyr_2.1.0                 
##  [55] locfit_1.5-9.4                labeling_0.4.2               
##  [57] tidyselect_1.1.0              rlang_0.4.10                 
##  [59] later_1.1.0.1                 AnnotationDbi_1.53.1         
##  [61] munsell_0.5.0                 BiocVersion_3.13.1           
##  [63] tools_4.1.0                   cachem_1.0.4                 
##  [65] generics_0.1.0                RSQLite_2.2.3                
##  [67] ExperimentHub_1.17.1          evaluate_0.14                
##  [69] stringr_1.4.0                 fastmap_1.1.0                
##  [71] yaml_2.2.1                    ragg_1.1.0                   
##  [73] grDevices_4.1.0               knitr_1.31                   
##  [75] bit64_4.0.5                   fs_1.5.0                     
##  [77] purrr_0.3.4                   KEGGREST_1.31.1              
##  [79] AnnotationFilter_1.15.0       sparseMatrixStats_1.3.6      
##  [81] mime_0.10                     xml2_1.3.2                   
##  [83] biomaRt_2.47.4                compiler_4.1.0               
##  [85] beeswarm_0.2.3                filelock_1.0.2               
##  [87] curl_4.3                      png_0.1-7                    
##  [89] interactiveDisplayBase_1.29.0 tibble_3.0.6                 
##  [91] statmod_1.4.35                bslib_0.2.4                  
##  [93] stringi_1.5.3                 highr_0.8                    
##  [95] basilisk.utils_1.3.7          GenomicFeatures_1.43.3       
##  [97] desc_1.2.0                    lattice_0.20-41              
##  [99] bluster_1.1.5                 ProtGenerics_1.23.7          
## [101] Matrix_1.3-2                  vctrs_0.3.6                  
## [103] pillar_1.4.7                  lifecycle_1.0.0              
## [105] BiocManager_1.30.10           jquerylib_0.1.3              
## [107] BiocNeighbors_1.9.4           bitops_1.0-6                 
## [109] irlba_2.3.3                   httpuv_1.5.5                 
## [111] rtracklayer_1.51.4            R6_2.5.0                     
## [113] BiocIO_1.1.2                  promises_1.2.0.1             
## [115] gridExtra_2.3                 vipor_0.4.5                  
## [117] zellkonverter_1.1.4           assertthat_0.2.1             
## [119] openssl_1.4.3                 rprojroot_2.0.2              
## [121] rjson_0.2.20                  withr_2.4.1                  
## [123] GenomicAlignments_1.27.2      Rsamtools_2.7.1              
## [125] datasets_4.1.0                GenomeInfoDbData_1.2.4       
## [127] hms_1.0.0                     grid_4.1.0                   
## [129] beachmat_2.7.6                rmarkdown_2.7                
## [131] DelayedMatrixStats_1.13.5     Rtsne_0.15                   
## [133] shiny_1.6.0                   ggbeeswarm_0.6.0             
## [135] restfulr_0.0.13</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kevin Rue-Albrecht, Aaron Lun, Charlotte Soneson, Michael Stadler.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
